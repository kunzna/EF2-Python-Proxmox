name: custom:com.dynatrace.proxmox-topomaping
version: 0.0.64
minDynatraceVersion: 1.328.0
minEECVersion: "1.309.0"
author:
  name: "Dynatrace"

keywords:
  - "VIRTUALIZATION"
  - "PROXMOX"
python:
  runtime:
    module: proxmox
    version:
      min: "3.10"

  activation:
    remote:
      path: activationSchema.json
    local:
      path: activationSchema.json

  featureSets:
  - featureSet: Cluster
    metrics:
    - key: proxmox.cluster.node
    - key: proxmox.cluster.node.online
    - key: proxmox.cluster.ha.quorate
    - key: proxmox.cluster.ha.status
    - key: proxmox.cluster.sdn.status
  - featureSet: Node
    metrics:
    - key: proxmox.node.vm
    - key: proxmox.node.lxc
    - key: proxmox.node.online
    - key: proxmox.node.cpu.usage
    - key: proxmox.node.cpu.wait
    - key: proxmox.node.cpu.idle
    - key: proxmox.node.memory.free
    - key: proxmox.node.memory.total
    - key: proxmox.node.memory.used
    - key: proxmox.node.uptime
    - key: proxmox.node.loadavg.1min
    - key: proxmox.node.loadavg.5min
    - key: proxmox.node.loadavg.10min
    - key: proxmox.node.rootfs.avail
    - key: proxmox.node.rootfs.used
    - key: proxmox.node.rootfs.free
    - key: proxmox.node.rootfs.total
    - key: proxmox.node.swap.free
    - key: proxmox.node.swap.total
    - key: proxmox.node.swap.used
  - featureSet: Node-Storage
    metrics:
    - key: proxmox.node.storage.total
    - key: proxmox.node.storage.used
    - key: proxmox.node.storage.avail
  - featureSet: Node-Services
    metrics:
    - key: proxmox.node.service.state
    - key: proxmox.node.service.activestate
    - key: proxmox.node.service.unitstate
  - featureSet: VM
    metrics:
    - key: proxmox.vm.network.netin
    - key: proxmox.vm.network.netout
    - key: proxmox.vm.disk.write
    - key: proxmox.vm.disk.max
    - key: proxmox.vm.disk.read
    - key: proxmox.vm.memory.max
    - key: proxmox.vm.memory.mem
    - key: proxmox.vm.cpu.usable
    - key: proxmox.vm.cpu.usage
    - key: proxmox.vm.uptime
    - key: proxmox.vm.status
    - key: proxmox.vm.memory.free
    - key: proxmox.vm.balloon
    - key: proxmox.vm.qmp.status
  - featureSet: CONTAINER
    metrics:
    - key: proxmox.lxc.network.netout
    - key: proxmox.lxc.uptime
    - key: proxmox.lxc.swap.max
    - key: proxmox.lxc.disk.write
    - key: proxmox.lxc.network.netin
    - key: proxmox.lxc.disk.read
    - key: proxmox.lxc.memory.mem
    - key: proxmox.lxc.cpu.usage
    - key: proxmox.lxc.cpu.usable
    - key: proxmox.lxc.memory.max
    - key: proxmox.lxc.status
    - key: proxmox.lxc.disk.usage
    - key: proxmox.lxc.swap.usage
    - key: proxmox.lxc.disk.max

metrics:
- key: proxmox.cluster.node
  metadata:
    displayName: Node Count
    description: Total Nodes running in the Cluster
    sourceEntityType: proxmox:cluster
    unit: Count
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.cluster

- key: proxmox.cluster.node.online
  metadata:
    displayName: Node Online Count
    description: Total Nodes running and online in the Cluster
    sourceEntityType: proxmox:cluster
    unit: Count
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.cluster

- key: proxmox.cluster.ha.quorate
  metadata:
    displayName: HA Quorate
    description: HA Quorate Status of the Cluster
    sourceEntityType: proxmox:cluster
    unit: Count
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.cluster
    
- key: proxmox.cluster.ha.status
  metadata:
    displayName: HA Status
    description: HA Status of the Cluster
    sourceEntityType: proxmox:cluster
    unit: State
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.cluster

- key: proxmox.cluster.sdn.status
  metadata:
    displayName: SDN Status
    description: SDN Status of the Cluster
    sourceEntityType: proxmox:cluster
    unit: State
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.cluster

- key: proxmox.node.vm
  metadata:
    displayName: VM Count
    description: Total VMs running on the Proxmox Node
    sourceEntityType: proxmox:node
    unit: Count
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.lxc
  metadata:
    displayName: Container Count
    description: Total Containers running on the Proxmox Node
    sourceEntityType: proxmox:node
    unit: Count
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.online
  metadata:
    displayName: Online Status
    description: Running State of the node
    sourceEntityType: proxmox:node
    unit: State
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.cpu.usage
  metadata:
    displayName: CPU Used
    description: The current cpu usage
    sourceEntityType: proxmox:node
    unit: Percent
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.cpu.wait
  metadata:
    displayName: CPU Wait
    description: The current cpu wait
    sourceEntityType: proxmox:node
    unit: Percent
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.cpu.idle
  metadata:
    displayName: CPU Idle
    description: The current cpu idle
    sourceEntityType: proxmox:node
    unit: Percent
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.memory.free
  metadata:
    displayName: Memory Free
    description: The free memory in bytes
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.memory.total
  metadata:
    displayName: Memory Total
    description: The total memory in bytes
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.memory.used
  metadata:
    displayName: Memory Used
    description: The used memory in bytes
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.uptime
  metadata:
    displayName: Node Uptime
    description: Node uptime in seconds
    sourceEntityType: proxmox:node
    unit: Second
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.loadavg.1min
  metadata:
    displayName: CPU Load (1m)
    description: Average 1 minute CPU Load
    sourceEntityType: proxmox:node
    unit: Percent
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.loadavg.5min
  metadata:
    displayName: CPU Load (5m)
    description: Average 5 minute CPU Load
    sourceEntityType: proxmox:node
    unit: Percent
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.loadavg.15min
  metadata:
    displayName: CPU Load (15m)
    description: Average 15 minute CPU Load
    sourceEntityType: proxmox:node
    unit: Percent
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.rootfs.avail
  metadata:
    displayName: Root FS Available
    description: The available bytes in the root filesystem
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.rootfs.used
  metadata:
    displayName: Root FS Used
    description: The used bytes in the root filesystem
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.rootfs.free
  metadata:
    displayName: Root FS Free
    description: The free bytes in the root filesystem
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.rootfs.total
  metadata:
    displayName: Root FS Total
    description: The total bytes in the root filesystem
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.swap.free
  metadata:
    displayName: Swap Free
    description: The free swap space
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.swap.total
  metadata:
    displayName: Swap Total
    description: The total swap space
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.swap.used     
  metadata:
    displayName: Swap Used
    description: The used swap space
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.storage.total
  metadata:
    displayName: Storage Total
    description: Total storage space in bytes
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: storage
      displayName: Storage Name
    - key: nodestoragetype
      displayName: Storage Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.storage.used
  metadata:
    displayName: Storage Used
    description: Used storage space in bytes
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: storage
      displayName: Storage Name
    - key: nodestoragetype
      displayName: Storage Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.storage.avail
  metadata:
    displayName: Storage Available
    description: Available storage space in bytes
    sourceEntityType: proxmox:node
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: nodestorage
      displayName: Storage Name
    - key: nodestoragetype
      displayName: Storage Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.service.state
  metadata:
    displayName: Service State
    description: Running State of the service
    sourceEntityType: proxmox:node
    unit: State
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: service
      displayName: Service ID
    - key: service_name
      displayName: Service Name
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.service.activestate
  metadata:
    displayName: Service Active State
    description: Active State of the service
    sourceEntityType: proxmox:node
    unit: State
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: service
      displayName: Service ID
    - key: service_name
      displayName: Service Name
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.node.service.unitstate
  metadata:
    displayName: Service Unit State
    description: Unit State of the service
    sourceEntityType: proxmox:node
    unit: State
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: service
      displayName: Service ID
    - key: service_name
      displayName: Service Name
    tags:
    - com.dynatrace.proxmox
    - proxmox.node

- key: proxmox.vm.memory.free
  metadata:
    displayName: Memory Free
    description: Currently free memory in bytes
    sourceEntityType: proxmox:vm
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.balloon
  metadata:
    displayName: Balloon Memory
    description: Currently Balloon memory in bytes
    sourceEntityType: proxmox:vm
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.qmp.status
  metadata:
    displayName: QMP Monitor Status
    description: VM run state from the query-status QMP monitor command
    sourceEntityType: proxmox:vm
    unit: State
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.network.netin
  metadata:
    displayName: Network Ingress
    description: The amount of traffic in bytes that was sent to the guest over the network since it was started
    sourceEntityType: proxmox:vm
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.network.netout
  metadata:
    displayName: Network Egress
    description: The amount of traffic in bytes that was sent from the guest over the network since it was started
    sourceEntityType: proxmox:vm
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP    
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.disk.write
  metadata:
    displayName: Disk Write
    description: The amount of bytes the guest wrote from it's block devices since the guest was started
    sourceEntityType: proxmox:vm
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP   
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.disk.max
  metadata:
    displayName: Disk Size
    description: Root disk size in bytes
    sourceEntityType: proxmox:vm
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.disk.read
  metadata:
    displayName: Disk Read
    description: The amount of bytes the guest read from it's block devices since the guest was started
    sourceEntityType: proxmox:vm
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.memory.max
  metadata:
    displayName: Memory Total
    description: Maximum memory in bytes
    sourceEntityType: proxmox:vm
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.memory.mem
  metadata:
    displayName: Memory Used
    description: Currently used memory in bytes
    sourceEntityType: proxmox:vm
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP 
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.cpu.usable
  metadata:
    displayName: CPU Usable
    description: Maximum usable CPUs
    sourceEntityType: proxmox:vm
    unit: Count
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP  
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.cpu.usage
  metadata:
    displayName: CPU Usage
    description: Current CPU usage
    sourceEntityType: proxmox:vm
    unit: Percent
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP    
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.uptime
  metadata:
    displayName: VM Uptime
    description: Uptime in seconds
    sourceEntityType: proxmox:vm
    unit: Second
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP     
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.vm.status
  metadata:
    displayName: VM Status
    description: Running Status of the VM
    sourceEntityType: proxmox:vm
    unit: State
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: vmname
      displayName: VM Name
    - key: vmid
      displayName: VM ID
    - key: vmips
      displayName: VM IP
    tags:
    - com.dynatrace.proxmox
    - proxmox.vm

- key: proxmox.lxc.network.netout
  metadata:
    displayName: Network Egress
    description: The amount of traffic in bytes that was sent from the guest over the network since it was started
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.uptime
  metadata:
    displayName: Container Uptime
    description: Uptime in seconds
    sourceEntityType: proxmox:container
    unit: Second
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.swap.max
  metadata:
    displayName: Swap Memory Total
    description: Maximum swap memory in bytes
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.disk.write
  metadata:
    displayName: Disk Write
    description: The amount of bytes the guest wrote from it's block devices since the guest was started
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.network.netin
  metadata:
    displayName: Network Ingress
    description: The amount of traffic in bytes that was sent to the guest over the network since it was started
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.disk.read
  metadata:
    displayName: Disk Read
    description: The amount of bytes the guest read from it's block devices since the guest was started
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.memory.mem
  metadata:
    displayName: Memory Used
    description: Currently used memory in bytes
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.cpu.usage
  metadata:
    displayName: CPU Used
    description: The current cpu usage
    sourceEntityType: proxmox:container
    unit: Percent
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.cpu.usable
  metadata:
    displayName: CPU Usable
    description: Maximum usable CPUs
    sourceEntityType: proxmox:container
    unit: Percent
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.memory.max
  metadata:
    displayName: Memory Total
    description: Maximum memory in bytes
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.status
  metadata:
    displayName: VM Status
    description: Running Status of the Container
    sourceEntityType: proxmox:container
    unit: State
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.disk.usage
  metadata:
    displayName: Disk Used
    description: The amount of disk used space in bytes
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.swap.usage
  metadata:
    displayName: Swap Used
    description: The amount of swap memory used in bytes
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

- key: proxmox.lxc.disk.max
  metadata:
    displayName: Disk Size
    description: Root disk size in bytes
    sourceEntityType: proxmox:container
    unit: Byte
    dimensions:
    - key: cluster
      displayName: Cluster Name
    - key: clusterid
      displayName: Cluster ID
    - key: node
      displayName: Node Name
    - key: nodeid
      displayName: Node ID
    - key: lxcname
      displayName: Container Name
    - key: lxcid
      displayName: Container ID
    - key: lxctype
      displayName: Container Type
    tags:
    - com.dynatrace.proxmox
    - proxmox.container

topology:
  types:
  - name: proxmox:cluster
    displayName: Cluster
    rules:
    - idPattern: proxmox_cluster_{cluster}
      instanceNamePattern: '{clusterid}'
      iconPattern: cluster
      attributes:
      - key: cluster
        displayName: Cluster Name
        pattern: '{cluster}'
      - key: clusterid
        displayName: Cluster ID
        pattern: '{clusterid}'
      - key: dt.security_context
        displayName: Security Context
        pattern: '{dt.security_context}'
      sources:
      - sourceType: Metrics
        condition: $prefix(proxmox.cluster.)
      - sourceType: Metrics
        condition: $prefix(proxmox.node.)
      - sourceType: Metrics
        condition: $prefix(proxmox.node.storage.)
      - sourceType: Metrics
        condition: $prefix(proxmox.node.service.)
      - sourceType: Metrics
        condition: $prefix(proxmox.vm.)
      - sourceType: Metrics
        condition: $prefix(proxmox.lxc.)

  - name: proxmox:node
    displayName: Node
    rules:
    - idPattern: proxmox_node_{cluster}_{node}
      instanceNamePattern: '{nodeid}'
      iconPattern: server
      attributes:
      - key: cluster
        displayName: Cluster Name
        pattern: '{cluster}'
      - key: clusterid
        displayName: Cluster ID
        pattern: '{clusterid}'
      - key: node
        displayName: Node Name
        pattern: '{node}'
      - key: nodeip
        displayName: Node IP
        pattern: '{nodeip}'
      - key: nodeid
        displayName: Node ID
        pattern: '{nodeid}'
      - key: dt.security_context
        displayName: Security Context
        pattern: '{dt.security_context}'
      - key: cpuinfo_cores
        displayName: CPU Cores
        pattern: '{cpuinfo_cores}'
      - key: cpuinfo_sockets
        displayName: CPU Sockets
        pattern: '{cpuinfo_sockets}'
      sources:
      - sourceType: Metrics
        condition: $prefix(proxmox.node.)
      - sourceType: Metrics
        condition: $prefix(proxmox.node.storage.)
      - sourceType: Metrics
        condition: $prefix(proxmox.node.service.)
      - sourceType: Metrics
        condition: $prefix(proxmox.vm.)
      - sourceType: Metrics
        condition: $prefix(proxmox.lxc.)

  - name: proxmox:vm
    displayName: Virtual Machine
    rules:
    - idPattern: proxmox_vm_{cluster}_{node}_{vmid}
      instanceNamePattern: '{vmid}'
      iconPattern: vm
      attributes:
      - key: cluster
        displayName: Cluster Name
        pattern: '{cluster}'
      - key: clusterid
        displayName: Cluster ID
        pattern: '{clusterid}'
      - key: node
        displayName: Node Name
        pattern: '{node}'
      - key: nodeip
        displayName: Node IP
        pattern: '{nodeip}'         
      - key: vmid
        displayName: VM ID
        pattern: '{vmid}'
      - key: vmname
        displayName: VM Name
        pattern: '{vmname}'
      - key: vmips
        displayName: VM IP
        pattern: '{vmips}'
      - key: dt.security_context
        displayName: Security Context
        pattern: '{dt.security_context}'
      sources:
      - sourceType: Metrics
        condition: $prefix(proxmox.vm.)

  - name: proxmox:container
    displayName: Container
    rules:
    - idPattern: proxmon_container_{cluster}_{node}_{lxcid}
      instanceNamePattern: '{lxcid}'
      iconPattern: container
      attributes:
      - key: cluster
        displayName: Cluster Name
        pattern: '{cluster}'
      - key: clusterid
        displayName: Cluster ID
        pattern: '{clusterid}'
      - key: node
        displayName: Node Name
        pattern: '{node}'
      - key: nodeip
        displayName: Node IP
        pattern: '{nodeip}'
      - key: vmid
        displayName: VM ID
        pattern: '{lxcid}'
      - key: vmname
        displayName: VM Name
        pattern: '{lxcname}'
      - key: dt.security_context
        displayName: Security Context
        pattern: '{dt.security_context}'
      sources:
      - sourceType: Metrics
        condition: $prefix(proxmox.lxc.)

  relationships:
  - typeOfRelation: CHILD_OF
    fromType: proxmox:node
    toType: proxmox:cluster
    sources:
    - sourceType: Metrics
      condition: $prefix(proxmox.node.)
  - typeOfRelation: CHILD_OF
    fromType: proxmox:vm
    toType: proxmox:cluster
    sources:
    - sourceType: Metrics
      condition: $prefix(proxmox.node.)
  - typeOfRelation: CHILD_OF
    fromType: proxmox:container
    toType: proxmox:cluster
    sources:
    - sourceType: Metrics
      condition: $prefix(proxmox.lxc.)
  - typeOfRelation: RUNS_ON
    fromType: proxmox:vm
    toType: proxmox:node
    sources:
    - sourceType: Metrics
      condition: $prefix(proxmox.vm.)
  - typeOfRelation: RUNS_ON
    fromType: proxmox:container
    toType: proxmox:node
    sources:
    - sourceType: Metrics
      condition: $prefix(proxmox.lxc.)      
  - typeOfRelation: SAME_AS
    fromType: proxmox:node
    toType: host
    sources:
    - sourceType: Entities
      mappingRules:
      - sourceProperty: nodeip
        sourceTransformation: To lower case
        destinationProperty: dt.ip_addresses
        destinationTransformation: To lower case
  - typeOfRelation: SAME_AS
    fromType: proxmox:vm
    toType: host
    sources:
    - sourceType: Entities
      mappingRules:
      - sourceProperty: vmips
        sourceTransformation: To lower case
        destinationProperty: dt.ip_addresses
        destinationTransformation: To lower case

screens:
- entityType: proxmox:cluster
  listSettings:
    staticContent:
      showGlobalFilter: false
      header:
        title: Proxmox Clusters
        description: List of Proxmox Clusters
        icon: cluster
      breadcrumbs:
        - type: NOOP
          displayName: Proxmox
        - type: ENTITY_LIST_REF
          displayName: Clusters
          entityType: proxmox:cluster
    layout:
      autoGenerate: false
      cards:
      - key: proxmox_cluster_charts_overview
        type: CHART_GROUP
      - key: proxmox_cluster_list_self
        type: ENTITIES_LIST
      - type: INJECTIONS    
  detailsSettings: 
    target: BOTH
    staticContent:
      showProblems: true
      showProperties: true
      showTags: true
      showGlobalFilter: false
      showAddTag: true
      breadcrumbs:
        - type: NOOP
          displayName: Proxmox
        - type: ENTITY_LIST_REF
          displayName: Clusters
          entityType: proxmox:cluster
    layout:
      autoGenerate: false
      cards:
      - key: proxmox_cluster_charts_overview
        type: CHART_GROUP
      - key: proxmox_cluster_nodes
        type: ENTITIES_LIST
      - type: INJECTIONS

  chartsCards:
  - key: proxmox_cluster_charts_overview
    target: BOTH
    mode: NORMAL
    numberOfVisibleCharts: 7
    displayName: Cluster Overview
    description: Overview of Proxmox Clusters
    charts:
    - displayName: Nodes
      visualizationType: SINGLE_VALUE
      singleValueConfig:
        metric:
          metricSelector: proxmox.node.online:splitBy("dt.entity.proxmox:cluster"):sum:sort(value(max,descending)):last
          dqlQuery: >
            timeseries nodes = count(proxmox.node.online, scalar: true), by: { `dt.entity.proxmox:cluster` }, filter:{`dt.entity.proxmox:cluster` == $entityId}
            | summarize { nodes = sum(nodes)}, by:{ `dt.entity.proxmox:cluster` }
        showSparkline: true
        showTrend: true

    - displayName: Virtual Machines
      visualizationType: SINGLE_VALUE
      singleValueConfig:
        metric:
          metricSelector: proxmox.node.vm:splitBy("dt.entity.proxmox:cluster"):sum:sort(value(max,descending)):last
          dqlQuery: >
            timeseries vms = max(proxmox.node.vm, scalar:true), by: { `dt.entity.proxmox:node`, `dt.entity.proxmox:cluster` }, filter:{`dt.entity.proxmox:cluster` == $(entityId)}
              | summarize { vms = sum(vms)}, by:{`dt.entity.proxmox:cluster`}
        showTrend: true
        showSparkline: true

    - displayName: Containers
      visualizationType: SINGLE_VALUE
      singleValueConfig:
        metric:
          metricSelector: proxmox.node.lxc:splitBy("dt.entity.proxmox:cluster"):sum:sort(value(max,descending)):last
          dqlQuery: >
            timeseries vms = max(proxmox.node.lxc, scalar:true), by: { `dt.entity.proxmox:node`, `dt.entity.proxmox:cluster` }, filter:{`dt.entity.proxmox:cluster` == $(entityId)}
              | summarize { vms = sum(vms)}, by:{`dt.entity.proxmox:cluster`}
        showTrend: true
        showSparkline: true

    - displayName: HA Quorate Nodes
      visualizationType: SINGLE_VALUE
      singleValueConfig:  
        metric:
          metricSelector: proxmox.cluster.ha.quorate:splitBy("dt.entity.proxmox:cluster"):sort(value(auto,descending)):last
          dqlQuery: >
            timeseries ha_quorate = proxmox.cluster.ha.quorate, by: { `dt.entity.proxmox:cluster` }, filter:{`dt.entity.proxmox:cluster` == $(entityId)}
              | summarize { ha_quorate = sum(ha_quorate)}, by:{`dt.entity.proxmox:cluster`}
        showTrend: true
        showSparkline: true

    - displayName: HA Quorate Nodes
      visualizationType: SINGLE_VALUE
      singleValueConfig:  
        metric:
          metricSelector: proxmox.cluster.ha.status:splitBy("dt.entity.proxmox:cluster"):sort(value(auto,descending)):last
          dqlQuery: >
            timeseries ha_status = proxmox.cluster.ha.status, by: { `dt.entity.proxmox:cluster` }, filter:{`dt.entity.proxmox:cluster` == $(entityId)}
              | summarize { ha_status = sum(ha_status)}, by:{`dt.entity.proxmox:cluster`}
        showTrend: true
        showSparkline: true

    - displayName: HA Status
      visualizationType: SINGLE_VALUE
      singleValueConfig:  
        metric:
          metricSelector: proxmox.cluster.ha.status:splitBy("dt.entity.proxmox:cluster"):sort(value(auto,descending)):last
          dqlQuery: >
            timeseries ha_status = proxmox.cluster.ha.status, by: { `dt.entity.proxmox:cluster` }, filter:{`dt.entity.proxmox:cluster` == $(entityId)}
              | summarize { ha_status = sum(ha_status)}, by:{`dt.entity.proxmox:cluster`}
        showTrend: true
        showSparkline: true

    - displayName: SDN Status
      visualizationType: SINGLE_VALUE
      singleValueConfig:  
        metric:
          metricSelector: proxmox.cluster.ha.status:splitBy("dt.entity.proxmox:cluster"):sort(value(auto,descending)):last
          dqlQuery: >
            timeseries sdn_status = proxmox.cluster.sdn.status, by: { `dt.entity.proxmox:cluster` }, filter:{`dt.entity.proxmox:cluster` == $(entityId)}
              | summarize { sdb_status = sum(sdv_status)}, by:{`dt.entity.proxmox:cluster`}
        showTrend: true
        showSparkline: true

  entitiesListCards:
  - key: proxmox_cluster_list_self
    displayName: Clusters
    pageSize: 5
    entitiesLimit: 500
    displayCharts: false
    numberOfVisibleCharts: 2
    enableDetailsExpandability: false
    displayIcons: true

    charts:
    - displayName: Nodes Online
      visualizationType: GRAPH_CHART
      graphChartConfig:
        metrics:
        - metricSelector: proxmox.cluster.node.online:last
    
    - displayName: Nodes Total
      visualizationType: GRAPH_CHART
      graphChartConfig:
        metrics:
        - metricSelector: proxmox.cluster.node:last

    - displayName: Virtual Machines Total
      visualizationType: GRAPH_CHART
      graphChartConfig:
        metrics:
        - metricSelector: proxmox.node.vm

    - displayName: Containers Total
      visualizationType: GRAPH_CHART
      graphChartConfig:
        metrics:
        - metricSelector: proxmox.node.lxc

    columns:
    - type: RELATION
      relation:
        entitySelectorTemplate: type(proxmox:node),fromRelationships.isChildOf($(entityConditions))
        displayName: Nodes
        displayAmount: true
        fallbackMessage: No nodes

  - key: proxmox_cluster_nodes
    displayName: Nodes
    pageSize: 5
    entitiesLimit: 100
    displayCharts: false
    enableDetailsExpandability: false
    numberOfVisibleCharts: 2
    displayIcons: true
    entitySelectorTemplate: type(proxmox:node),fromRelationships.runsOn($(entityConditions))

    charts:
    - displayName: Memory Used
      visualizationType: GRAPH_CHART
      graphChartConfig:
        metrics:
        - metricSelector: proxmox.node.memory.used:last
    - displayName: CPU Usage
      visualizationType: GRAPH_CHART
      graphChartConfig:
        metrics:
        - metricSelector: proxmox.node.cpu.usage:last

documents:
  dashboards:
    - displayName: Proxmox Overview
      path: documents/proxmox_overview.dashboard.json
